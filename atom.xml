<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>wenlin&#39;s Blog</title>
  
  
  <link href="/blog/atom.xml" rel="self"/>
  
  <link href="https://ironnman.github.io/blog/"/>
  <updated>2019-04-17T20:30:11.536Z</updated>
  <id>https://ironnman.github.io/blog/</id>
  
  <author>
    <name>wenlin42</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Laravel 又拍云上传</title>
    <link href="https://ironnman.github.io/blog/2019/04/18/Laravel-%E5%8F%88%E6%8B%8D%E4%BA%91%E4%B8%8A%E4%BC%A0/"/>
    <id>https://ironnman.github.io/blog/2019/04/18/Laravel-又拍云上传/</id>
    <published>2019-04-17T20:20:15.000Z</published>
    <updated>2019-04-17T20:30:11.536Z</updated>
    
    <content type="html"><![CDATA[<p>首先我使用 Google 搜索 <code>Laravel upyun php-sdk</code> 这些关键词<br><img src="https://iocaffcdn.phphub.org/uploads/images/201810/26/20500/cFHT8AOOxg.png?imageView2/2/w/1240/h/0" alt="file"><br>首先搜索到的是 <a href="https://github.com/JellyBool" target="_blank" rel="noopener">JellyBool</a> 的 <a href="https://github.com/JellyBool/flysystem-upyun" target="_blank" rel="noopener">Laravel 扩展包</a>，这个扩展包把又拍云的 <a href="https://github.com/upyun/php-sdk" target="_blank" rel="noopener">php-sdk</a> 集成到 Laravel 项目会比较方便。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">composer require <span class="string">"jellybool/flysystem-upyun"</span></span><br></pre></td></tr></table></figure><p>安装完成之后</p><p>在 <code>config/app.php</code> 里添加 <code>UpyunServiceProvider</code>:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'providers'</span> =&gt; [</span><br><span class="line">    <span class="comment">// Other service providers...</span></span><br><span class="line">    JellyBool\Flysystem\Upyun\UpyunServiceProvider::class,</span><br><span class="line">],</span><br></pre></td></tr></table></figure><p>在 <code>config/filesystems.php</code> 的 <code>disks</code> 中添加下面的配置：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> [</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">      <span class="string">'upyun'</span> =&gt; [</span><br><span class="line">                <span class="string">'driver'</span>        =&gt; <span class="string">'upyun'</span>, </span><br><span class="line">                <span class="string">'bucket'</span>        =&gt; env(<span class="string">'UPYUN_BUCKET'</span>,  <span class="string">'服务名称'</span>)</span><br><span class="line">                <span class="string">'operator'</span>      =&gt; env(<span class="string">'UPYUN_OPERATOR'</span>, <span class="string">'操作员的名字'</span>),</span><br><span class="line">                <span class="string">'password'</span>      =&gt; env(<span class="string">'UPYUN_PASSWORD'</span>, <span class="string">'操作员的密码'</span>),</span><br><span class="line">                <span class="string">'domain'</span>        =&gt; env(<span class="string">'UPYUN_DOMAIN'</span>, <span class="string">'服务分配的域名'</span>),</span><br><span class="line">                <span class="string">'protocol'</span>     =&gt; <span class="string">'http'</span>, <span class="comment">// 服务使用的协议，如需使用 http，在此配置 http</span></span><br><span class="line">            ],</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">];</span><br></pre></td></tr></table></figure><p>然后在 <code>.env</code> 文件配置, 并且拷贝到 <code>.env.example</code> 文件里<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">UPYUN_BUCKET=</span><br><span class="line">UPYUN_OPERATOR=</span><br><span class="line">UPYUN_PASSWORD=</span><br><span class="line">UPYUN_DOMAIN=</span><br></pre></td></tr></table></figure></p><p><img src="https://iocaffcdn.phphub.org/uploads/images/201810/26/20500/9Elc4ZNMzF.png?imageView2/2/w/1240/h/0" alt="file"></p><p>域名可绑定自己的线上项目域名，然后在 <code>内容管理</code> 里面添加管理员和密码（如果管理员和密码不匹配就会报）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">401 Unauthorized 错误</span><br></pre></td></tr></table></figure></p><h2 id="快速测试"><a href="#快速测试" class="headerlink" title="快速测试"></a>快速测试</h2><h3 id="如果你想快速测试自己的配置信息是否正确又或者服务是否可行"><a href="#如果你想快速测试自己的配置信息是否正确又或者服务是否可行" class="headerlink" title="如果你想快速测试自己的配置信息是否正确又或者服务是否可行"></a>如果你想快速测试自己的配置信息是否正确又或者服务是否可行</h3><p>在 <code>resources/views/pages</code> 下，新建文件视图 <code>image.blade.php</code>。<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">@extends(<span class="string">'layouts.app'</span>)</span><br><span class="line">@section(<span class="string">'title'</span>, <span class="string">'又拍云图片上传测试'</span>)</span><br><span class="line"></span><br><span class="line">@section(<span class="string">'content'</span>)</span><br><span class="line">    &lt;div class="container"&gt;</span><br><span class="line">        &lt;h1 class="text-center"&gt;图片上传&lt;/h1&gt;</span><br><span class="line">        &lt;div class="content"&gt;</span><br><span class="line">            &lt;form enctype=<span class="string">"multipart/form-data"</span> method=<span class="string">"post"</span> action=<span class="string">"/image"</span>&gt;</span><br><span class="line">                &#123;&#123; csrf_field() &#125;&#125;</span><br><span class="line">                &lt;div class="form-group"&gt;</span><br><span class="line">                    &lt;input type=<span class="string">"file"</span> name=<span class="string">"image"</span> value=<span class="string">"选择文件"</span>&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">                &lt;div class="form-group"&gt;</span><br><span class="line">                    &lt;input type="submit" class="form-control" value="上传图片"&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">            &lt;/form&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">@stop</span><br></pre></td></tr></table></figure></p><p>然后在 <code>routes/web.php</code> 文件里添加以下代码：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Http</span>\<span class="title">Request</span>;</span><br><span class="line">.</span><br><span class="line">.</span><br><span class="line">.</span><br><span class="line"><span class="comment">// 图片上传测试</span></span><br><span class="line">Route::get(<span class="string">'/image'</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> view(<span class="string">'pages.image'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">Route::post(<span class="string">'/image'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(Request $request)</span> </span>&#123;</span><br><span class="line">    $domain = <span class="string">"http://"</span> . config(<span class="string">'filesystems.disks.upyun.domain'</span>);</span><br><span class="line">    $file_path = Storage::disk(<span class="string">'upyun'</span>)-&gt;put(<span class="string">'/image'</span>, $request-&gt;file(<span class="string">'image'</span>));</span><br><span class="line">    <span class="keyword">return</span> $domain . <span class="string">"/$file_path"</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p><p>完成之后访问 <code>http://项目名称.test/image</code> 链接，在视图里面测试图片上传，如果上传成功会返回完整的链接。</p><p>复制链接，在新的窗口打开。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">如果图片没有显示，可能要等 3 - 10 分钟才神奇的显示。</span><br><span class="line"></span><br><span class="line">如果有谁知道是什么原因，麻烦告诉我一下。</span><br></pre></td></tr></table></figure><p>可在 Laravel 文档的 <a href="https://learnku.com/docs/laravel/5.5/filesystem/1319" target="_blank" rel="noopener">文件存储</a> 中查看更多的可用方法。</p><p>CNAME 可绑定你线上的二级域名: upload.线上域名 <a href="https://www.alibabacloud.com/help/zh/doc-detail/58456.htm" target="_blank" rel="noopener">解析记录冲突判断规则</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;首先我使用 Google 搜索 &lt;code&gt;Laravel upyun php-sdk&lt;/code&gt; 这些关键词&lt;br&gt;&lt;img src=&quot;https://iocaffcdn.phphub.org/uploads/images/201810/26/20500/cFHT8AO
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Hello World</title>
    <link href="https://ironnman.github.io/blog/2019/04/14/hello-world/"/>
    <id>https://ironnman.github.io/blog/2019/04/14/hello-world/</id>
    <published>2019-04-13T19:17:49.706Z</published>
    <updated>2019-04-13T19:17:49.707Z</updated>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;Welcome to &lt;a href=&quot;https://hexo.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Hexo&lt;/a&gt;! This is your very first post. Check &lt;a href=&quot;https://hexo.
      
    
    </summary>
    
    
  </entry>
  
</feed>
